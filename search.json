[
  {
    "objectID": "blog_start.html",
    "href": "blog_start.html",
    "title": "Blog",
    "section": "",
    "text": "Post With Code\n\n\n\n\n\n\n\nnews\n\n\ncode\n\n\nanalysis\n\n\n\n\n\n\n\n\n\n\n\nMay 31, 2024\n\n\nHarlow Malloc\n\n\n\n\n\n\n  \n\n\n\n\nWelcome To My Blog\n\n\n\n\n\n\n\nnews\n\n\n\n\n\n\n\n\n\n\n\nMay 28, 2024\n\n\nTristan O’Malley\n\n\n\n\n\n\n  \n\n\n\n\nAge-, and sex-adjusted incidence rates\n\n\n\n\n\n\n\nR\n\n\nincidence-rate\n\n\npoisson-regression\n\n\nsurvival-analysis\n\n\n\n\n\n\n\n\n\n\n\nNov 15, 2021\n\n\nMichael Dismorr\n\n\n\n\n\n\nNo matching items"
  },
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "michaeldismorrmd.github.io",
    "section": "",
    "text": "This is a Quarto website.\nTo learn more about Quarto websites visit https://quarto.org/docs/websites.\n\n1 + 1\n\n[1] 2"
  },
  {
    "objectID": "posts/welcome/index.html",
    "href": "posts/welcome/index.html",
    "title": "Welcome To My Blog",
    "section": "",
    "text": "This is the first post in a Quarto blog. Welcome!\n\nSince this post doesn’t specify an explicit image, the first image in the post will be used in the listing page of posts."
  },
  {
    "objectID": "posts/post-with-code/index.html",
    "href": "posts/post-with-code/index.html",
    "title": "Post With Code",
    "section": "",
    "text": "This is a post with executable code.\n\n1 + 1\n\n[1] 2"
  },
  {
    "objectID": "posts/age-and-sex-adjusted-incidence-rates/index.html",
    "href": "posts/age-and-sex-adjusted-incidence-rates/index.html",
    "title": "Age-, and sex-adjusted incidence rates",
    "section": "",
    "text": "In this first post I’m going to present a way of obtaining age- and sex-adjusted incidence rates using poisson regression in R. This will be similar to what is done in Stata as described here.\nI’ve written a R function that’s available for download here. The script can be sourced ( source(\"age_sex_adjust.R\") ) and then the function age_sex_adjust() can be used as is. Note that the time variable will have to be in days, and the incidence will be presented as per 100 person-years. The code will also be described step by step below.\n\nThere are, as usual, several ways to calculate adjusted incidence rates in R. I’ve chosen to use the package marginaleffects by Vincent Arel-Bundock, Noah Greifer and Andrew Heiss because it has a lot of nice features and useful implications in causal inference. Specifically, we will use the function avg_predictions() from marginaleffects to generate the the adjusted incidence rates.\nBut first we start off with a little bit of background on what an incidence rate is. It is simply a measure of a number of occurrences (a count) in a population over the total population time. For example, in a population of 10 people, each followed 1 year, there was one case of death. In that population, the incidence rate of death would 1 per 10 person-years. In observational data, we often have larger cohorts with varying follow-up time and censoring. The calculation is of course the same, using the formula below:\n \\[\\text{Incidence rate} = \\frac{\\text{Number of occurrences}}{\\sum_{\\text{Persons}}{\\text{Time in study}}}\\] \n\n\nCalculating crude incidence rate\nTo illustrate, we will now use the colon dataset from the survival package.\n\nlibrary(survival)\nlibrary(dplyr)\nlibrary(broom)\n\nRunning ?survival::colon tells us the following:\n\nData from one of the first successful trials of adjuvant chemotherapy for colon cancer\n\n\n\n\n\n\n\n\nVariable\nExplanation\n\n\n\n\nid\nPatient id\n\n\nstudy\n1 for all patients\n\n\nrx\n1 for all patients\n\n\nsex\n1 = male\n\n\nage\nin years\n\n\nobstruct\ncolon obstruction by tumour\n\n\nperfor\nperformation of colon\n\n\nadhere\nadherence to nearby organs\n\n\nnodes\nnumber of positive lymph nodes\n\n\ntime\ndays until event or censoring\n\n\nstatus\ncensoring status\n\n\ndiffer\ntumour differentiation — 1 = well, 2 = moderate, 3 = poor\n\n\nextent\nextent of local spread — 1 = submucosa, 2 = muscle, 3 = serosa, 4 = continious\n\n\nsurg\ntime from surgery to registration — 0 = short, 1 = long\n\n\nnode4\nmore than 4 positive lymph nodes\n\n\netype\nevent type — 1 = recurrence, 2 = death\n\n\n\nOK, so now that we understand the data, let’s start calculating crude incidence rates for death among the different treatment groups:\n\n# Using the colon dataset from the survival package\n\n# Only keep records related to the death outcome\ncolon_death &lt;- survival::colon %&gt;% dplyr::filter(etype == 2) \n\n# Time is divided by 365.25/100 to get the time in days \n# first to years, then to 100 person-years\n\ncolon_death %&gt;% group_by(rx) %&gt;% \n                summarise(Events = sum(status), \n                          Time = sum(time/365.25/100), \n                          Rate = Events / Time, \n                          lower = poisson.test(Events, Time)$conf.int[1], \n                          upper = poisson.test(Events, Time)$conf.int[2])\n\n# A tibble: 3 × 6\n  rx      Events  Time  Rate lower upper\n  &lt;fct&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;\n1 Obs        168  13.8 12.2  10.4  14.2 \n2 Lev        161  13.7 11.7  10.0  13.7 \n3 Lev+5FU    123  15.0  8.22  6.83  9.80\n\n\nNow we compare to the calculated rates with rates obtained from the survRate() function from the biostat3 package:\n\nlibrary(biostat3)\nsurvRate(Surv(time/365.25/100, status) ~ rx, data = colon_death) %&gt;% \n  dplyr::select(rx, event, tstop, rate, lower, upper) %&gt;% \n  as_tibble() %&gt;% \n  dplyr::rename(Events = event, \n                Time = tstop, \n                Rate = rate)\n\n# A tibble: 3 × 6\n  rx      Events  Time  Rate lower upper\n  &lt;fct&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;\n1 Obs        168  13.8 12.2  10.4  14.2 \n2 Lev        161  13.7 11.7  10.0  13.7 \n3 Lev+5FU    123  15.0  8.22  6.83  9.80\n\n\nGood, the incidence rates are identical. The observational patients had an mortality incidence rate of 12.2 per 100 person-years, compared to the Lev+5-FU treated patients with an incidence rate of 8.22 per 100 person-years. Now, let’s try and repeat these results with poisson regression.\n\n\nObtaining estimated incidence rates using poisson regression\nHere we use the broom package tidy() function to obtain exponentiated estimates:\n\n# Fit the model to estimate IRR using offset\npoisson_fit &lt;- glm(status ~ rx + offset(log(time/365.25/100)), \n                   family = poisson, data = colon_death)\n\n# Exponentiate the estimate to obtain IRR\ntidy(poisson_fit, exponentiate = T, conf.int = T)\n\n# A tibble: 3 × 7\n  term        estimate std.error statistic   p.value conf.low conf.high\n  &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;\n1 (Intercept)   12.2      0.0772    32.4   3.13e-230   10.4      14.1  \n2 rxLev          0.965    0.110     -0.324 7.46e-  1    0.777     1.20 \n3 rxLev+5FU      0.675    0.119     -3.32  9.16e-  4    0.534     0.850\n\n\nThe Intercept estimate here is the estimated IR for the reference level, i.e. the Obs group.\nTo get estimated IR of Lev+5FU treated:\n\nlev_5fu &lt;- predict(poisson_fit, \n                   newdata = data.frame(rx = \"Lev+5FU\", time = 36525), \n                   type = \"link\", se.fit = T)\n\nas_tibble(lev_5fu) %&gt;% summarise(Treatment = \"Lev+5FU\", \n                                 IR = exp(fit), \n                                 lower = exp(fit - (1.96 * se.fit)), \n                                 upper = exp(fit + (1.96 * se.fit)))\n\n# A tibble: 1 × 4\n  Treatment    IR lower upper\n  &lt;chr&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;\n1 Lev+5FU    8.22  6.88  9.80\n\n\nHere, the confidence interval needs to be calculated on the \\(\\log\\) scale and then exponentiated back. This will cause the confidence interval to not be centered around the estimate.\nA poisson model can model \\(\\log\\text{incidence rates (ratios)}\\) when we use the time variable as an offset. Therefore, we can include covariates in the model to be accounted for, such as age and sex.\n\n\nAge- and sex-adjusted incidence rates using poisson regression\nFirst, we’ll do it using my age_sex_adjust() function\n\nsource(\"age_sex_adjust.R\")\n# Usage: age_sex_adjust(data, group, age, sex, event, time)\n\nage_sex_adjust(colon_death, rx, age, sex, status, time)\n\n  Treatment        IR  Lower_CI  Upper_CI\n1   Lev+5FU  8.245483  6.786784  9.704182\n2       Obs 12.211861 10.362612 14.061109\n3       Lev 11.819634  9.990691 13.648577\n\n\nHere we see that the adjusted rates are very similar to the crude rates calculated above. Since this data comes from a randomized trial, this is expected and can be taken as a sign that the randomization worked.\nNow, let’s do the some thing but without using the ready made function to see how it works under the hood.\n\nlibrary(marginaleffects)\n\n# Fit the model using offset to estimate IRR\npoisson_fit &lt;- glm(status ~ rx * I(age^2) + sex + offset(log(as.numeric(time))), \n                   data = colon_death, \n                   family = poisson)\n\n# Create a new dataset where time is converted to 36525 days (100 years)\nnewdat &lt;- colon_death %&gt;% mutate(time = 36525) \n\n# Use avg_predictions to estimate what the incidence rate would have been if \n# the entire population would have been treated according to each level of rx\nresult &lt;- avg_predictions(poisson_fit, \n                          variables = \"rx\", \n                          newdata = transform(colon_death, time = 36525), \n                          type = \"response\")\n\nresult %&gt;% dplyr::select(rx, estimate, conf.low, conf.high)\n\n\n Estimate CI low CI high\n     8.25   6.79     9.7\n    12.21  10.36    14.1\n    11.82   9.99    13.6\n\nColumns: rx, estimate, conf.low, conf.high \n\n\nThe numbers are identical to the ones obtained from the age_sex_adjust() function, which is logical since we did the same thing as the function does.\nA few finishing notes. Here I included age as a quadratic term, and as an interaction with exposure. These are modeling decisions one will have to take, however the model could have been only a main effects model such as:\n \\[\\log\\lambda = \\beta_0 + \\beta_1\\text{rxLev} + \\beta_2\\text{rxLev+5FU} + \\beta_3\\text{age} + \\beta_4\\text{sex}\\]  Regarding the interaction term, a good explanation was given in the Stata forum in this post.\nFor anyone who wants to read more, I recommend the course material from the PhD course Biostatistics III at Karolinska Institutet, available here."
  },
  {
    "objectID": "about.html",
    "href": "about.html",
    "title": "Michael Dismorr",
    "section": "",
    "text": "I am a M.D., PhD and postdoctoral researcher at Karolinska Institutet in the cardiothoracic surgery research group.\nHere I will primarily post guides and tutorials related to epidemiology in R. Topics will range from survival analysis with regression standardization and inverse probability of treatment weighting (IPTW) to more workflow related guides. Feel free to reach out with comments or suggestions.\nFor more content like this, check out R-bloggers."
  },
  {
    "objectID": "about.html#about",
    "href": "about.html#about",
    "title": "Michael Dismorr",
    "section": "",
    "text": "I am a M.D., PhD and postdoctoral researcher at Karolinska Institutet in the cardiothoracic surgery research group.\nHere I will primarily post guides and tutorials related to epidemiology in R. Topics will range from survival analysis with regression standardization and inverse probability of treatment weighting (IPTW) to more workflow related guides. Feel free to reach out with comments or suggestions.\nFor more content like this, check out R-bloggers."
  },
  {
    "objectID": "about.html#intrests",
    "href": "about.html#intrests",
    "title": "Michael Dismorr",
    "section": "Intrests",
    "text": "Intrests\n\nR programming\nBiostatistics\nSurvival analysis\nGlobal health\nMedTech\nAI"
  },
  {
    "objectID": "about.html#experience",
    "href": "about.html#experience",
    "title": "Michael Dismorr",
    "section": "Experience",
    "text": "Experience\nPostdoctoral researcher | 2022 - Current\nKarolinska Institutet | Stockholm, Sweden\nCo-founder | 2022 - Current\nDismorr Medical Ltd. | Nairobi, Kenya\nPhD student | 2017 - 2022\nKarolinska Institutet | Stockholm, Sweden\nSurgeon, licensed physician | 2018 - 2020\nKarolinska University Hospital, Dept. Cardiothoracic surgery | Stockholm, Sweden\nMedical internship | 2017 - 2018\nKarolinska University Hospital | Stockholm, Sweden\nJunior surgeon | 2016 - 2017\nKarolinska University Hospital, Dept. Cardiothoracic surgery | Stockholm, Sweden"
  },
  {
    "objectID": "about.html#education",
    "href": "about.html#education",
    "title": "Michael Dismorr",
    "section": "Education",
    "text": "Education\nPhD, Cardiothoracic surgery epidemiology | 2017 - 2022\nKarolinska Institutet | Stockholm, Sweden\nMedical school, MD | 2011 - 2016\nKarolinska Institutet | Stockholm, Sweden\nGlobal health, field studies | 2015 - 2016\nKarolinska Institutet | Tanzania"
  }
]